import System.Environment
import Text.HandsomeSoup
import Text.XML.HXT.Core
import Control.Monad
import System.IO

exploitDbUrl number = "http://www.exploit-db.com/ghdb/" ++ show number ++ "/"

collectHelper file 0 exploits = return exploits
collectHelper file number exploits = do
        doc <- fromUrl . exploitDbUrl $ number
        exploit <- runX $ doc >>> css "h2 a" >>> getAttrValue "href"
        hPutStrLn file (head exploit)
        collectHelper file (number - 1) (exploit:exploits)

collect file number = collectHelper file number []

main = do
        [number,filePath] <- getArgs
        outh <- openFile filePath WriteMode
        result <- collect outh (read number :: Int)
        hClose outh
